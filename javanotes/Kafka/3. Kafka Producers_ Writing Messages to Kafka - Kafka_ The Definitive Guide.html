<!DOCTYPE html>
<!-- saved from url=(0112)https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#writing_messages_to_kafka -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage no-applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/kafka-the-definitive/9781491936153/ch03.html" data-csrf-cookie="csrfsafari" data-user-id="10375405" data-user-uuid="4a6f73c4-7349-4949-9ed6-be14a97df95e" data-username="mailtomanojsharma45" data-account-type="Trial" data-activated-trial-date="12/28/2020" data-archive="9781491936153" data-publishers="O&#39;Reilly Media, Inc." data-htmlfile-name="ch03.html" data-epub-title="Kafka: The Definitive Guide" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="O&#39;Reilly Media"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491936153"><link rel="shortcut icon" href="https://www.oreilly.com/favicon.ico"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/css" rel="stylesheet" type="text/css"><title>3. Kafka Producers: Writing Messages to Kafka - Kafka: The Definitive Guide</title><link rel="stylesheet" href="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/output.5bdb4fcb2aad.css" type="text/css"><link rel="stylesheet" type="text/css" href="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:2em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content p[data-type="footnote"]{font-size:90% !important;line-height:1.2em !important;margin-left:2.5em !important;text-indent:-2.3em !important}#sbo-rt-content p[data-type="footnote"] sup{display:inline-block !important;position:static !important;width:2em !important;text-align:right !important;font-size:100% !important;padding-right:.5em !important}#sbo-rt-content p[data-type="footnote"] a[href$="-marker"]{font-family:sans-serif !important;font-size:90% !important;color:#8e0012 !important}#sbo-rt-content p[data-type="footnote"] a[data-type="xref"]{margin:0 !important;padding:0 !important;text-indent:0 !important}#sbo-rt-content a[data-type="noteref"]{font-family:sans-serif !important;color:#8e0012;margin-left:0;padding-left:0}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content table.border tbody>tr:last-child>td{border-bottom:transparent}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content .width-10{width:10vw !important}#sbo-rt-content .width-20{width:20vw !important}#sbo-rt-content .width-30{width:30vw !important}#sbo-rt-content .width-40{width:40vw !important}#sbo-rt-content .width-50{width:50vw !important}#sbo-rt-content .width-60{width:60vw !important}#sbo-rt-content .width-70{width:70vw !important}#sbo-rt-content .width-80{width:80vw !important}#sbo-rt-content .width-90{width:90vw !important}#sbo-rt-content .width-full,#sbo-rt-content .width-100{width:100vw !important}#sbo-rt-content table code{word-break:break-all !important;word-wrap:break-word !important;white-space:normal !important;overflow:visible}
    </style><script type="text/javascript" async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/cool-2.1.15.min.js.download"></script><script type="text/javascript" async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/ec.js.download"></script><script type="text/javascript" async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/analytics.js.download"></script><script type="text/javascript" async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/f.txt"></script><script type="text/javascript" async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/js"></script><script crossorigin="anonymous" integrity="sha256-YVd5f+oOy6EXRL0nbPFPXaaqax2k37tbmOkUYa0jZW4=" type="text/javascript" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/appcues.main.cfc53af059b5b93bea8cf68f5507901513619ad8.js.download" async=""></script><script async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/gtm.js.download"></script><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781491936153/chapter/ch03.html",
          "book_id": "9781491936153",
          "chapter_uri": "ch03.html",
          "position": 0,
          "user_uuid": "4a6f73c4-7349-4949-9ed6-be14a97df95e",
          "next_chapter_uri": "/library/view/kafka-the-definitive/9781491936153/ch04.html"
        
      },
      title: "Kafka: The Definitive Guide",
      author_list: "Neha Narkhede, Gwen Shapira, Todd Palino",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/modernizr.8e35451ddb64.js.download"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html"><meta name="description" content=" Chapter 3. Kafka Producers: Writing Messages to Kafka Whether you use Kafka as a queue, message bus, or data storage platform, you will always use Kafka by writing a producer ... "><meta property="og:title" content="3. Kafka Producers: Writing Messages to Kafka"><meta itemprop="isPartOf" content="/library/view/kafka-the-definitive/9781491936153/"><meta itemprop="name" content="3. Kafka Producers: Writing Messages to Kafka"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781491936153/"><meta property="og:description" itemprop="description" content=" Chapter 3. Kafka Producers: Writing Messages to Kafka Whether you use Kafka as a queue, message bus, or data storage platform, you will always use Kafka by writing a producer ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O&#39;Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781491936160"><meta property="og:book:author" itemprop="author" content="Neha Narkhede"><meta property="og:book:author" itemprop="author" content="Gwen Shapira"><meta property="og:book:author" itemprop="author" content="Todd Palino"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OReillyMedia"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '4a6f73c4-7349-4949-9ed6-be14a97df95e';
      dataLayer.push({userIdentifier: '4a6f73c4-7349-4949-9ed6-be14a97df95e'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '0fa50266-fd42-43a6-be36-e5b2a13c9b6a';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/vendor.2804c0c54c57.js.download"></script><script defer="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/reader.590e4106cb9f.js.download"></script><iframe src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/saved_resource.html"></iframe><iframe src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/saved_resource(2).html"></iframe><iframe src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/saved_resource(3).html"></iframe><link rel="stylesheet" type="text/css" integrity="sha256-q9sKb2HpA5fJjN1cK9LjLaEXff5ix81Rv1Y3xJFptPE=" crossorigin="anonymous" href="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/container.cfc53af059b5b93bea8cf68f5507901513619ad8.css"><iframe src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/saved_resource(4).html"></iframe><script src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/f(1).txt"></script><script async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/MathJax.js.download"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/4a6f73c4-7349-4949-9ed6-be14a97df95e/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/featured/navigating-21st-century/" class="l2 nav-icn"><span>Navigating Change</span></a></li><li><a href="https://learning.oreilly.com/recommendations/" class="l2 nav-icn"><span>Recommended</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Releases</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Shared Playlists</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.8 3.2A1.2 1.2 0 0 1 14 4.4v8.4a1.2 1.2 0 0 1-1.2 1.2H3.2A1.2 1.2 0 0 1 2 12.8V4.4a1.2 1.2 0 0 1 1.2-1.2h1.2V2h1.2v1.2h4.8V2h1.2v1.2h1.2zm-9.6 9.6h9.6V6.2H3.2v6.6zM8 9.5a1.35 1.35 0 1 1 0-2.7 1.35 1.35 0 0 1 0 2.7zm2.7 2.148v.552H5.3v-.552c0-.321.124-.634.355-.858a3.358 3.358 0 0 1 4.69 0c.23.224.355.537.355.858z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Trainings</span></a></li><li><a href="https://learning.oreilly.com/featured/architectural-katas" class="l2 nav-icn"><span>Architectural Katas</span></a></li><li><a href="https://learning.oreilly.com/featured/strata/" class="l2 nav-icn"><span>Strata</span></a></li><li><a href="https://learning.oreilly.com/featured/oscon/" class="l2 nav-icn"><span>Open Source</span></a></li><li><a href="https://learning.oreilly.com/featured/infrastructure-ops/" class="l2 nav-icn"><span>Infra &amp; Ops</span></a></li><li><a href="https://learning.oreilly.com/featured/software-architecture/" class="l2 nav-icn"><span>Software Arch</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Interact</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/?classification=content-scenario" class="l2 nav-icn"><span>Scenarios</span></a></li><li><a href="https://learning.oreilly.com/scenarios/?classification=sandbox-scenario" class="l2 nav-icn"><span>Sandboxes</span></a></li><li><a href="https://learning.oreilly.com/interactive/?classification=jupyter-notebook" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li><a href="https://learning.oreilly.com/answers/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M2.31032699,3.75609006 C4.65421571,1.41371359 8.45302454,1.41472092 10.7955702,3.75860838 C13.1381158,6.10249583 13.1369405,9.90130261 10.7930518,12.243847 C8.44916311,14.5863913 4.65018639,14.5852161 2.30780867,12.2413286 C-0.0346204845,9.89749489 -0.0334929936,6.09853298 2.31032699,3.75609006 Z M8.8198605,4.98016308 C7.34193969,3.86924672 5.23410194,3.98609692 3.88914868,5.33104946 C3.12814393,6.09032122 2.72818176,7.13880077 2.79015179,8.21201133 C2.79115912,8.23064692 2.79233434,8.24928252 2.79350956,8.26791811 L2.79350956,8.26791811 C2.83179539,8.8307976 2.9944077,9.37404287 3.26947292,9.86201677 L3.26947292,9.86201677 L2.77621706,11.7027432 C2.7699968,11.7259241 2.77662063,11.7506624 2.79359185,11.7676337 C2.8105631,11.7846049 2.83530144,11.7912287 2.85848233,11.7850085 L2.85848233,11.7850085 L4.69400524,11.2922565 C5.26306363,11.6167344 5.90703177,11.786885 6.56209849,11.7858479 C8.64827865,11.7858479 10.3395879,10.094542 10.3395879,8.00836292 C10.3405204,6.84135608 9.80105674,5.73967784 8.87862141,5.02482134 L8.87862141,5.02482134 L8.82825492,4.98654283 Z M13.7933062,2 C14.7073496,2.00009863 15.4482759,2.74110484 15.4482759,3.65514822 C15.4482759,4.32460943 15.0449926,4.92814782 14.4264842,5.18432286 C13.8079757,5.44049789 13.096053,5.29885769 12.6226979,4.82545158 C12.1493429,4.35204547 12.0077795,3.64010743 12.2640213,3.02162665 C12.5202631,2.40314587 13.123845,1.99992776 13.7933062,2 Z"></path></svg><span>Answers</span></a></li><li><a href="https://learning.oreilly.com/certifications/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M12.912 9.18L14 8.014l-1.088-1.18a.304.304 0 01-.075-.268L13.195 5l-1.535-.463a.313.313 0 01-.194-.194l-.462-1.537-1.565.358c-.09.03-.194 0-.269-.074L8.007 2 6.845 3.09a.303.303 0 01-.269.074l-1.565-.358-.462 1.537a.313.313 0 01-.194.194L2.82 5l.358 1.567a.26.26 0 01-.075.269L2 8.015l1.088 1.164c.075.075.09.18.075.269l-.358 1.567 1.535.463c.09.03.164.104.194.194l.462 1.537 1.565-.358c.015 0 .045-.015.075-.015.075 0 .15.03.209.074L8.007 14l1.163-1.09a.303.303 0 01.269-.074l1.565.358.462-1.537a.313.313 0 01.194-.194L13.195 11l-.358-1.567a.338.338 0 01.075-.254zm-6.046 1.37L4.41 8.26l1.16-1.244 1.767 1.649L10.4 5.6l1.202 1.202-4.242 4.243-.495-.495z"></path></svg><span>Certifications</span></a></li><li><a href="https://learning.oreilly.com/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Kafka: The Definitive Guide
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" title="Search in archive" class="js-search-controls search-controls" onclick="window.Appcues.track(&#39;SearchBook_HeronBook&#39;)"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781491936153/chapter/ch03.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards" onclick="window.Appcues.track(&#39;AddPlaylist_HeronBook&#39;)"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size" onclick="window.Appcues.track(&#39;ChangeFont_HeronBook&#39;)"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share" onclick="window.Appcues.track(&#39;Share_HeronBook&#39;)"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html&amp;text=Kafka%3A%20The%20Definitive%20Guide&amp;via=OReillyMedia"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%203.%20Kafka%20Producers%3A%20Writing%20Messages%20to%20Kafka&amp;body=https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html%0D%0Afrom%20Kafka%3A%20The%20Definitive%20Guide%0D%0A"><span>Email</span></a></li></ul></li><!-- endif request.user.is_authenticated -->
      </ul>
    </div>

      
          
      

    <section role="document">
        
        




  <script defer="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/djangoMessagesPage.fd5a76de2264.js.download"></script>


        <script src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/48743.js.download"></script>
<script>
  var userId = "4a6f73c4-7349-4949-9ed6-be14a97df95e";

  var userObject = {
    firstName: "Manoj",
    segment: "Trial",
    admin: "False",
    profileCreatedOn: "2020-12-28",
    academic: ""
  };
  window.Appcues.identify(userId, userObject);
  window.Appcues.page();

  setTimeout(function () {
    window.Appcues.track('ViewingBook_HeronBook')
  }, 20000);
</script>


	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch02.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">2. Installing Kafka</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch04.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">4. Kafka Consumers: Reading Data from Kafka</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. Kafka Producers: Writing Messages to Kafka"><div class="chapter" id="writing_messages_to_kafka">
<h1><span class="label">Chapter 3. </span>Kafka Producers: Writing Messages <span class="keep-together">to Kafka</span></h1>


<p><a data-type="indexterm" data-primary="producers" id="ix_ch03-asciidoc0"></a>Whether you use Kafka as a queue, message bus, or data storage platform, you will always use Kafka by writing a producer that writes data to Kafka, a consumer that reads data from Kafka, or an application that serves both roles.</p>

<p>For example, in a credit card transaction processing system, there will be a client application, perhaps an online store, responsible for sending each transaction to Kafka immediately when a payment is made. Another application is responsible for immediately checking this transaction against a rules engine and determining whether the transaction is approved or denied. The approve/deny response can then be written back to Kafka and the response can propagate back to the online store where the transaction was initiated. A third application can read both transactions and the approval status from Kafka and store them in a database where analysts can later review the decisions and perhaps improve the rules engine.</p>

<p>Apache Kafka ships with built-in client APIs that developers can use when developing applications that interact with Kafka.</p>

<p>In this chapter we will learn how to use the Kafka producer, starting with an overview of its design and components. We will show how to create <code>KafkaProducer</code> and <code>ProducerRecord</code> objects, how to send records to Kafka, and how to handle the errors that Kafka may return. We’ll then review the most important configuration options used to control the producer behavior. We’ll conclude with a deeper look at how to use different partitioning methods and serializers,  and how to write your own serializers and partitioners.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch04.html#reading_data_from_kafka">Chapter&nbsp;4</a> we will look at Kafka’s consumer client and reading data from Kafka.</p>
<div data-type="note" epub:type="note"><h1>Third-Party Clients</h1>
<p><a data-type="indexterm" data-primary="binary wire protocol" id="idm45788274069320"></a><a data-type="indexterm" data-primary="wire protocol" id="idm45788274068616"></a>In addition to the built-in clients, Kafka has a binary wire protocol. This means that it is possible for applications to read messages from Kafka or write messages to Kafka simply by sending the correct byte sequences to Kafka’s network port. There are multiple clients that implement Kafka’s wire protocol in different programming languages, giving simple ways to use Kafka not just in Java applications but also in languages like C++, Python, Go, and many more. Those clients are not part of Apache Kafka project, but a list of non-Java clients is maintained in the <a href="https://cwiki.apache.org/confluence/display/KAFKA/Clients">project wiki</a>.
The wire protocol and the external clients are outside the scope of the chapter.</p>
</div>






<section data-type="sect1" data-pdf-bookmark="Producer Overview"><div class="sect1" id="idm45788274066264">
<h1>Producer Overview</h1>

<p><a data-type="indexterm" data-primary="producers" data-secondary="overview" id="ix_ch03-asciidoc1"></a>There are many reasons an application might need to write messages to Kafka: recording user activities for auditing or analysis, recording metrics, storing log messages, recording information from smart appliances, communicating asynchronously with other applications, buffering information before writing to a database, and much more.</p>

<p>Those diverse use cases also imply diverse requirements: is every message critical, or can we tolerate loss of messages? Are we OK with accidentally duplicating messages? Are there any strict latency or throughput requirements we need to support?</p>

<p>In the credit card transaction processing example we introduced earlier, we can see that it is critical to never lose a single message nor duplicate any messages. Latency should be low but latencies up to 500ms can be tolerated, and throughput should be very high—we expect to process up to a million messages a second.</p>

<p>A different use case might be to store click information from a website. In that case, some message loss or a few duplicates can be tolerated; latency can be high as long as there is no impact on the user experience. In other words, we don’t mind if it takes a few seconds for the message to arrive at Kafka, as long as the next page loads immediately after the user clicked on a link. Throughput will depend on the level of activity we anticipate on our website.</p>

<p>The different requirements will influence the way you use the producer API to write messages to Kafka and the configuration you use.</p>

<p>While the producer APIs are very simple, there is a bit more that goes on under the hood of the producer when we send data. <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#fig-1-overview">Figure&nbsp;3-1</a> shows the main steps involved in sending data to Kafka.</p>

<figure><div id="fig-1-overview" class="figure">
<img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/ktdg_0301.png" alt="ktdg 0301" width="1128" height="1248" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/ktdg_0301.png">
<h6><span class="label">Figure 3-1. </span>High-level overview of Kafka producer components</h6>
</div></figure>

<p>We start producing messages to Kafka by creating a <code>ProducerRecord</code>, which must include the topic we want to send the record to and a value. Optionally, we can also specify a key and/or a partition. Once we send the <code>ProducerRecord</code>, the first thing the producer will do is serialize the key and value objects to ByteArrays so they can be sent over the network.</p>

<p>Next, the data is sent to a partitioner. If we specified a partition in the <span class="keep-together"><code>ProducerRecord</code></span>, the partitioner doesn’t do anything and simply returns the partition we specified. If we didn’t, the partitioner will choose a partition for us, usually based on the <code>ProducerRecord</code> key.
Once a partition is selected, the producer knows which topic and partition the record will go to. It then adds the record to a batch of records that will also be sent to the same topic and partition. A separate thread is responsible for sending those batches of records to the appropriate Kafka brokers.</p>

<p>When the broker receives the messages, it sends back a response. If the messages were successfully written to Kafka, it will return a <code>RecordMetadata</code> object with the topic, partition, and the offset of the record within the partition. If the broker failed to write the messages, it will return an error. When the producer receives an error, it may retry sending the message a few more times before giving up and returning an error.<a data-type="indexterm" data-startref="ix_ch03-asciidoc1" id="idm45788274051432"></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Constructing a Kafka Producer"><div class="sect1" id="idm45788274065640">
<h1>Constructing a Kafka Producer</h1>

<p><a data-type="indexterm" data-primary="producers" data-secondary="constructing" id="idm45788274049288"></a>The first step in writing messages to Kafka is to create a producer object with the properties you want to pass to the producer.
<a data-type="indexterm" data-primary="producers" data-secondary="mandatory properties" id="idm45788274048040"></a>A Kafka producer has three mandatory properties:</p>
<dl>
<dt><code>bootstrap.servers</code></dt>
<dd>
<p><a data-type="indexterm" data-primary="bootstrap.servers property" id="idm45788274045208"></a>List of <code>host:port</code> pairs of brokers that the producer will use to establish initial connection to the Kafka cluster. This list doesn’t need to include all brokers, since the producer will get more information after the initial connection. But it is recommended to include at least two, so in case one broker goes down, the producer will still be able to connect to the cluster.</p>
</dd>
<dt><code>key.serializer</code></dt>
<dd>
<p><a data-type="indexterm" data-primary="key.serializer class" id="idm45788274042296"></a>Name of a class that will be used to serialize the keys of the records we will produce to Kafka. Kafka brokers expect byte arrays as keys and values of messages. However, the producer interface allows, using parameterized types, any Java object to be sent as a key and value. This makes for very readable code, but it also means that the producer has to know how to convert these objects to byte arrays. <code>key.serializer</code> should be set to a name of a class that implements the <code>org.apache.kafka.common.serialization.Serializer</code> interface. The producer will use this class to serialize the key object to a byte array. The Kafka client package includes <code>ByteArraySerializer</code> (which doesn’t do much), <span class="keep-together"><code>StringSerializer</code></span>, and <code>IntegerSerializer</code>, so if you use common types, there is no need to implement your own serializers. Setting <code>key.serializer</code> is required even if you intend to send only values.</p>
</dd>
<dt><code>value.serializer</code></dt>
<dd>
<p><a data-type="indexterm" data-primary="value.serializer class" id="idm45788274036312"></a>Name of a class that will be used to serialize the values of the records we will produce to Kafka. The same way you set <code>key.serializer</code> to a name of a class that will serialize the message key object to a byte array, you set <code>value.serializer</code> to a class that will serialize the message value object.</p>
</dd>
</dl>

<p>The following code snippet shows how to create a new producer by setting just the mandatory parameters and using defaults for everything else:</p>

<pre data-type="programlisting">Properties kafkaProps = new Properties(); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>
kafkaProps.put("bootstrap.servers", "broker1:9092,broker2:9092");

kafkaProps.put("key.serializer",
    "org.apache.kafka.common.serialization.StringSerializer"); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a>
kafkaProps.put("value.serializer",
    "org.apache.kafka.common.serialization.StringSerializer");

producer = new KafkaProducer&lt;String, String&gt;(kafkaProps); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>We start with a <code>Properties</code> object.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a></dt>
<dd><p>Since we plan on using strings for message key and value, we use the built-in <code>StringSerializer</code>.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO1-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a></dt>
<dd><p>Here we create a new producer by setting the appropriate key and value types and passing the <code>Properties</code> object.</p></dd>
</dl>

<p>With such a simple interface, it is clear that most of the control over producer behavior is done by setting the correct configuration properties. Apache Kafka documentation covers all the <a href="http://bit.ly/2sMu1c8">configuration options</a>, and we will go over the important ones later in this chapter.</p>

<p>Once we instantiate a producer, it is time to start sending messages. <a data-type="indexterm" data-primary="messages" data-secondary="primary methods of sending" id="idm45788274015144"></a>There are three primary methods of sending messages:</p>
<dl>
<dt><a data-type="indexterm" data-primary="fire-and-forget" id="idm45788274013160"></a>Fire-and-forget</dt>
<dd>
<p>We send a message to the server and don’t really care if it arrives succesfully or not. Most of the time, it will arrive successfully, since Kafka is highly available and the producer will retry sending messages automatically. However, some messages will get lost using this method.</p>
</dd>
<dt><a data-type="indexterm" data-primary="Synchronous Send" id="idm45788274010840"></a>Synchronous send</dt>
<dd>
<p>We send a message, the <code>send()</code> method returns a Future object, and we use <code>get()</code> to wait on the future and see if the <code>send()</code> was successful or not.</p>
</dd>
<dt><a data-type="indexterm" data-primary="Asynchronous Send" id="idm45788274007480"></a>Asynchronous send</dt>
<dd>
<p>We call the <code>send()</code> method with a callback function, which gets triggered when it receives a response from the Kafka broker.</p>
</dd>
</dl>

<p>In the examples that follow, we will see how to send messages using these methods and how to handle the different types of errors that might occur.</p>

<p>While all the examples in this chapter are single threaded, a producer object can be used by multiple threads to send messages.  You will probably want to start with one producer and one thread. If you need better throughput, you can add more threads that use the same producer. Once this ceases to increase throughput, you can add more producers to the application to achieve even higher throughput.</p>
</div></section>













<section data-type="sect1" class="pagebreak-before" data-pdf-bookmark="Sending a Message to Kafka"><div class="sect1" id="idm45788274050136">
<h1>Sending a Message to Kafka</h1>

<p><a data-type="indexterm" data-primary="messages" data-secondary="sending" id="ix_ch03-asciidoc2"></a><a data-type="indexterm" data-primary="producers" data-secondary="sending messages" id="ix_ch03-asciidoc3"></a>The simplest way to send a message is as follows:</p>

<pre data-type="programlisting">ProducerRecord&lt;String, String&gt; record =
    new ProducerRecord&lt;&gt;("CustomerCountry", "Precision Products",
        "France"); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>
try {
    producer.send(record); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a>
} catch (Exception e) {
    e.printStackTrace(); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a>
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>The producer accepts <code>ProducerRecord</code> objects, so we start by creating one. <span class="keep-together"><code>ProducerRecord</code></span> has multiple constructors, which we will discuss later. Here we use one that requires the name of the topic we are sending data to, which is always a string, and the key and value we are sending to Kafka, which in this case are also strings. The types of the key and value must match our <code>serializer</code> and <span class="keep-together"><code>producer</code></span> objects.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a></dt>
<dd><p>We use the producer object <code>send()</code> method to send the <code>ProducerRecord</code>. As we’ve seen in the producer architecture diagram in <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#fig-1-overview">Figure&nbsp;3-1</a>, the message will be placed in a buffer and will be sent to the broker in a separate thread. The <code>send()</code> method returns a <a href="http://bit.ly/2rG7Cg6">Java Future object</a> with <code>RecordMetadata</code>, but since we simply ignore the returned value, we have no way of knowing whether the message was sent successfully or not. This method of sending messages can be used when dropping a message silently is acceptable. This is not typically the case in production applications.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO2-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a></dt>
<dd><p>While we ignore errors that may occur while sending messages to Kafka brokers or in the brokers themselves, we may still get an exception if the producer encountered errors before sending the message to Kafka. Those can be a <span class="keep-together"><code>SerializationException</code></span> when it fails to serialize the message, a <code>BufferExhaustedException</code> or <code>TimeoutException</code> if the buffer is full, or an <code>InterruptException</code> if the sending thread was interrupted.</p></dd>
</dl>








<section data-type="sect2" data-pdf-bookmark="Sending a Message Synchronously"><div class="sect2" id="idm45788273975176">
<h2>Sending a Message Synchronously</h2>

<p>The simplest way to send a message synchronously is as follows:</p>

<pre data-type="programlisting">ProducerRecord&lt;String, String&gt; record =
    new ProducerRecord&lt;&gt;("CustomerCountry", "Precision Products", "France");
try {
    producer.send(record).get(); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>
} catch (Exception e) {
    e.printStackTrace(); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a>
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p><a data-type="indexterm" data-primary="messages" data-secondary="synchronous transmission" id="idm45788273965960"></a><a data-type="indexterm" data-primary="Synchronous Send" id="idm45788273964920"></a>Here, we are using <code>Future.get()</code> to wait for a reply from Kafka. This method will throw an exception if the record is not sent successfully to Kafka. If there were no errors, we will get a <code>RecordMetadata</code> object that we can use to retrieve the offset the message was written to.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO3-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a></dt>
<dd><p>If there were any errors before sending data to Kafka, while sending, if the Kafka brokers returned a nonretriable error or if we exhausted the available retries, we will encounter an exception. In this case, we just print any exception we ran into.</p></dd>
</dl>

<p><code>KafkaProducer</code> has two types of errors. <a data-type="indexterm" data-primary="retriable errors" data-secondary="about" id="idm45788273959128"></a><em>Retriable</em> errors are those that can be resolved by sending the message again. For example, a connection error can be resolved because the connection may get reestablished. <a data-type="indexterm" data-primary="leaders" data-secondary="no leader error" id="idm45788273957592"></a><a data-type="indexterm" data-primary="no leader error" id="idm45788273956616"></a>A “no leader” error can be resolved when a new leader is elected for the partition. <code>KafkaProducer</code> can be configured to retry those errors automatically, so the application code will get retriable exceptions only when the number of retries was exhausted and the error was not resolved.
Some errors will not be resolved by retrying. For example, “message size too large.” In those cases, <code>KafkaProducer</code> will not attempt a retry and will return the exception immediately.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Sending a Message Asynchronously"><div class="sect2" id="idm45788273954600">
<h2>Sending a Message Asynchronously</h2>

<p><a data-type="indexterm" data-primary="Asynchronous Send" id="idm45788273953176"></a><a data-type="indexterm" data-primary="messages" data-secondary="asynchronous transmission" id="idm45788273952472"></a>Suppose the network roundtrip time between our application and the Kafka cluster is 10ms. If we wait for a reply after sending each message, sending 100 messages will take around 1 second.
On the other hand, if we just send all our messages and not wait for any replies, then sending 100 messages will barely take any time at all. In most cases, we really don’t need a reply—Kafka sends back the topic, partition, and offset of the record after it was written, which is usually not required by the sending app. On the other hand, we do need to know when we failed to send a message completely so we can throw an exception, log an error, or perhaps write the message to an “errors” file for later analysis.</p>

<p><a data-type="indexterm" data-primary="callbacks" id="idm45788273950440"></a>In order to send messages asynchronously and still handle error scenarios, the producer supports adding a callback when sending a record. Here is an example of how we use a callback:</p>

<pre data-type="programlisting" class="pagebreak-before">private class DemoProducerCallback implements Callback { <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>
    @Override
    public void onCompletion(RecordMetadata recordMetadata, Exception e) {
        if (e != null) {
            e.printStackTrace(); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a>
        }
    }
}

ProducerRecord&lt;String, String&gt; record =
    new ProducerRecord&lt;&gt;("CustomerCountry", "Biomedical Materials", "USA"); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a>
producer.send(record, new DemoProducerCallback()); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-4" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-4"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/4.png"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>To use callbacks, you need a class that implements the <code>org.apache.kafka.</code> <span class="keep-together"><code>clients.producer.Callback</code></span> interface, which has a single function—<code>onCompletion()</code>.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a></dt>
<dd><p>If Kafka returned an error, <code>onCompletion()</code> will have a nonnull exception. Here we “handle” it by printing, but production code will probably have more robust error handling functions.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a></dt>
<dd><p>The records are the same as before.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-4" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO4-4"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/4.png"></a></dt>
<dd><p>And we pass a <code>Callback</code> object along when sending the record.<a data-type="indexterm" data-startref="ix_ch03-asciidoc3" id="idm45788273926456"></a><a data-type="indexterm" data-startref="ix_ch03-asciidoc2" id="idm45788273925752"></a></p></dd>
</dl>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Configuring Producers"><div class="sect1" id="idm45788273924952">
<h1>Configuring Producers</h1>

<p><a data-type="indexterm" data-primary="producers" data-secondary="configuring" id="ix_ch03-asciidoc4"></a>So far we’ve seen very few configuration parameters for the producers—just the mandatory <code>bootstrap.servers</code> URI and serializers.</p>

<p>The producer has a large number of configuration parameters; most are documented in Apache Kafka <a href="http://kafka.apache.org/documentation.html#producerconfigs">documentation</a> and many have reasonable defaults so there is no reason to tinker with every single parameter. However, some of the parameters have a significant impact on memory use, performance, and reliability of the producers. We will review those here.</p>










<section data-type="sect3" data-pdf-bookmark="acks"><div class="sect3" id="idm45788273919960">
<h3>acks</h3>

<p><a data-type="indexterm" data-primary="acks parameter" id="idm45788273918760"></a><a data-type="indexterm" data-primary="messages" data-secondary="acks parameter" id="idm45788273918056"></a>The <code>acks</code> parameter controls how many partition replicas must receive the record before the producer can consider the write successful. This option has a significant impact on how likely messages are to be lost. There are three allowed values for the <code>acks</code> parameter:</p>

<ul>
<li>
<p>If <code>acks=0</code>, the producer will not wait for a reply from the broker before assuming the message was sent successfully. This means that if something went wrong and the broker did not receive the message, the producer will not know about it and the message will be lost. However, because the producer is not waiting for any response from the server, it can send messages as fast as the network will support, so this setting can be used to achieve very high throughput.</p>
</li>
<li>
<p>If <code>acks=1</code>, the producer will receive a success response from the broker the moment the leader replica received the message. If the message can’t be written to the leader (e.g., if the leader crashed and a new leader was not elected yet), the producer will receive an error response and can retry sending the message, avoiding potential loss of data. The message can still get lost if the leader crashes and a replica without this message gets elected as the new leader (via unclean leader election). In this case, throughput depends on whether we send messages synchronously or asynchronously. If our client code waits for a reply from the server (by calling the <code>get()</code> method of the <code>Future</code> object returned when sending a message) it will obviously increase latency significantly (at least by a network roundtrip). If the client uses callbacks, latency will be hidden, but throughput will be limited by the number of in-flight messages (i.e., how many messages the producer will send before receiving replies from the server).</p>
</li>
<li>
<p>If <code>acks=all</code>, the producer will receive a success response from the broker once all in-sync replicas received the message. This is the safest mode since you can make sure more than one broker has the message and that the message will survive even in the case of crash (more information on this in <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch05.html#kafka_internals">Chapter&nbsp;5</a>). However, the latency we discussed in the <code>acks=1</code> case will be even higher, since we will be waiting for more than just one broker to receive the message.</p>
</li>
</ul>
</div></section>













<section data-type="sect3" data-pdf-bookmark="buffer.memory"><div class="sect3" id="idm45788273906968">
<h3>buffer.memory</h3>

<p><a data-type="indexterm" data-primary="buffer.memory parameter" id="idm45788273905768"></a>This sets the amount of memory the producer will use to buffer messages waiting to be sent to brokers. If messages are sent by the application faster than they can be delivered to the server, the producer may run out of space and additional <code>send()</code> calls will either block or throw an exception, based on the <code>block.on.buffer.full</code> parameter (replaced with <code>max.block.ms</code> in release 0.9.0.0, which allows blocking for a certain time and then throwing an exception).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="compression.type"><div class="sect3" id="idm45788273903016">
<h3>compression.type</h3>

<p><a data-type="indexterm" data-primary="compression.type parameter" id="idm45788273901816"></a>By default, messages are sent uncompressed. This parameter can be set to <code>snappy</code>, <code>gzip</code>, or <code>lz4</code>, in which case the corresponding compression algorithms will be used to compress the data before sending it to the brokers. Snappy compression was invented by Google to provide decent compression ratios with low CPU overhead and good performance, so it is recommended in cases where both performance and bandwidth are a concern. Gzip compression will typically use more CPU and time but results in better compression ratios, so it is recommended in cases where network bandwidth is more restricted. By enabling compression, you reduce network utilization and storage, which is often a bottleneck when sending messages to Kafka.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="retries"><div class="sect3" id="idm45788273898792">
<h3>retries</h3>

<p><a data-type="indexterm" data-primary="error messages" data-secondary="retries" id="idm45788273897592"></a><a data-type="indexterm" data-primary="retries parameter" id="idm45788273896616"></a>When the producer receives an error message from the server, the error could be transient (e.g., a lack of leader for a partition). In this case, the value of the <code>retries</code> parameter will control how many times the producer will retry sending the message before giving up and notifying the client of an issue. By default, the producer will wait 100ms between retries, but you can control this using the <code>retry.backoff.ms</code> parameter. We recommend testing how long it takes to recover from a crashed broker (i.e., how long until all partitions get new leaders) and setting the number of retries and delay between them such that the total amount of time spent retrying will be longer than the time it takes the Kafka cluster to recover from the crash—otherwise, the producer will give up too soon. Not all errors will be retried by the producer. Some errors are not transient and will not cause retries (e.g., “message too large” error). In general, because the producer handles retries for you, there is no point in handling retries within your own application logic. You will want to focus your efforts on handling nonretriable errors or cases where retry attempts were exhausted.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="batch.size"><div class="sect3" id="idm45788273893560">
<h3>batch.size</h3>

<p><a data-type="indexterm" data-primary="batch.size parameter" id="idm45788273892360"></a>When multiple records are sent to the same partition, the producer will batch them together. This parameter controls the amount of memory in bytes (not messages!) that will be used for each batch. When the batch is full, all the messages in the batch will be sent. However, this does not mean that the producer will wait for the batch to become full. The producer will send half-full batches and even batches with just a single message in them. Therefore, setting the batch size too large will not cause delays in sending messages; it will just use more memory for the batches. Setting the batch size too small will add some overhead because the producer will need to send messages more frequently.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="linger.ms"><div class="sect3" id="idm45788273890552">
<h3>linger.ms</h3>

<p><a data-type="indexterm" data-primary="linger.ms parameter" id="idm45788273889384"></a><code>linger.ms</code> controls the amount of time to wait for additional messages before sending the current batch. <code>KafkaProducer</code> sends a batch of messages either when the current batch is full or when the <code>linger.ms</code> limit is reached. By default, the producer will send messages as soon as there is a sender thread available to send them, even if there’s just one message in the batch. By setting <code>linger.ms</code> higher than 0, we instruct the producer to wait a few milliseconds to add additional messages to the batch before sending it to the brokers. This increases latency but also increases throughput (because we send more messages at once, there is less overhead per message).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="client.id"><div class="sect3" id="idm45788273886200">
<h3>client.id</h3>

<p><a data-type="indexterm" data-primary="client.id parameter" id="idm45788273885000"></a>This can be any string, and will be used by the brokers to identify messages sent from the client. It is used in logging and metrics, and for quotas.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="max.in.flight.requests.per.connection"><div class="sect3" id="idm45788273883752">
<h3>max.in.flight.requests.per.connection</h3>

<p><a data-type="indexterm" data-primary="max.in.flight.requests.per.connection parameter" id="idm45788273882616"></a>This controls how many messages the producer will send to the server without receiving responses. Setting this high can increase memory usage while improving throughput, but setting it too high can reduce throughput as batching becomes less efficient. Setting this to 1 will guarantee that messages will be written to the broker in the order in which they were sent, even when retries occur.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="timeout.ms, request.timeout.ms, and metadata.fetch.timeout.ms"><div class="sect3" id="idm45788273881032">
<h3>timeout.ms, request.timeout.ms, and metadata.fetch.timeout.ms</h3>

<p><a data-type="indexterm" data-primary="metadata.fetch.timeout.ms parameter" id="idm45788273879896"></a><a data-type="indexterm" data-primary="request.timeout.ms parameter" id="idm45788273878872"></a><a data-type="indexterm" data-primary="timeout.ms parameter" id="idm45788273878184"></a>These parameters control how long the producer will wait for a reply from the server when sending data (<code>request.timeout.ms</code>) and when requesting metadata such as the current leaders for the partitions we are writing to (<code>metadata.fetch.timeout.ms</code>). If the timeout is reached without reply, the producer will either retry sending or respond with an error (either through exception or the send callback). <code>timeout.ms</code> controls the time the broker will wait for in-sync replicas to acknowledge the message in order to meet the <code>acks</code> configuration—the broker will return an error if the time elapses without the necessary acknowledgments.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="max.block.ms"><div class="sect3" id="idm45788273874984">
<h3>max.block.ms</h3>

<p><a data-type="indexterm" data-primary="max.block.ms parameter" id="idm45788273873784"></a>This parameter controls how long the producer will block when calling <code>send()</code> and when explicitly requesting metadata via <code>partitionsFor()</code>. Those methods block when the producer’s send buffer is full or when metadata is not available. When <code>max.block.ms</code> is reached, a timeout exception is thrown.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="max.request.size"><div class="sect3" id="idm45788273871208">
<h3>max.request.size</h3>

<p><a data-type="indexterm" data-primary="max.request.size parameter" id="idm45788273870008"></a>This setting controls the size of a produce request sent by the producer. It caps both the size of the largest message that can be sent and the number of messages that the producer can send in one request. For example, with a default maximum request size of 1 MB, the largest message you can send is 1 MB or the producer can batch 1,024 messages of size 1 KB each into one request. In addition, the broker has its own limit on the size of the largest message it will accept (<code>message.max.bytes</code>). It is usually a good idea to have these configurations match, so the producer will not attempt to send messages of a size that will be rejected by the broker.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="receive.buffer.bytes and send.buffer.bytes"><div class="sect3" id="idm45788273867848">
<h3>receive.buffer.bytes and send.buffer.bytes</h3>

<p><a data-type="indexterm" data-primary="receive.buffer.bytes parameter" id="idm45788273866616"></a><a data-type="indexterm" data-primary="send.buffer.bytes parameter" id="idm45788273865896"></a>These are the sizes of the TCP send and receive buffers used by the sockets when writing and reading data. If these are set to -1, the OS defaults will be used. It is a good idea to increase those when producers or consumers communicate with brokers in a different datacenter because those network links typically have higher latency and lower bandwidth.</p>
<div data-type="warning" epub:type="warning"><h1>Ordering Guarantees</h1>
<p><a data-type="indexterm" data-primary="messages" data-secondary="ordering guarantees" id="idm45788273863576"></a><a data-type="indexterm" data-primary="ordering guarantees" id="idm45788273862600"></a><a data-type="indexterm" data-primary="producers" data-secondary="ordering guarantees" id="idm45788273861928"></a><a data-type="indexterm" data-primary="retries parameter" data-secondary="ordering guarantees" id="idm45788273860984"></a>Apache Kafka preserves the order of messages within a partition. This means that if messages were sent from the producer in a specific order, the broker will write them to a partition in that order and all consumers will read them in that order. For some use cases, order is very important. There is a big difference between depositing $100 in an account and later withdrawing it, and the other way around! However, some use cases are less sensitive.</p>

<p>Setting the <code>retries</code> parameter to nonzero and the <code>max.in.flight.requests.per.connection</code> to more than one means that it is possible that the broker will fail to write the first batch of messages, succeed to write the second (which was already in-flight), and then retry the first batch and succeed, thereby reversing the order.</p>

<p>Usually, setting the number of retries to zero is not an option in a reliable system, so if guaranteeing order is critical, we recommend setting <code>in.flight.requests.per.session=1</code> to make sure that while a batch of messages is retrying, additional messages will not be sent (because this has the potential to reverse the correct order). This will severely limit the throughput of the producer, so only use this when order is important.<a data-type="indexterm" data-startref="ix_ch03-asciidoc4" id="idm45788273856520"></a></p>
</div>
</div></section>



</div></section>













<section data-type="sect1" data-pdf-bookmark="Serializers"><div class="sect1" id="idm45788273924360">
<h1>Serializers</h1>

<p><a data-type="indexterm" data-primary="producers" data-secondary="serializers" id="ix_ch03-asciidoc5"></a><a data-type="indexterm" data-primary="serializers" id="ix_ch03-asciidoc6"></a>As seen in previous examples, producer configuration includes mandatory serializers. We’ve seen how to use the default String serializer. Kafka also includes serializers for integers and <code>ByteArrays</code>, but this does not cover most use cases. Eventually, you will want to be able to serialize more generic records.</p>

<p>We will start by showing how to write your own serializer and then introduce the Avro serializer as a recommended alternative.</p>








<section data-type="sect2" data-pdf-bookmark="Custom Serializers"><div class="sect2" id="idm45788273850552">
<h2>Custom Serializers</h2>

<p><a data-type="indexterm" data-primary="custom serializers" id="ix_ch03-asciidoc7"></a><a data-type="indexterm" data-primary="serializers" data-secondary="custom" id="ix_ch03-asciidoc8"></a>When the object you need to send to Kafka is not a simple string or integer, you have a choice of either using a generic serialization library like Avro, Thrift, or Protobuf to create records, or creating a custom serialization for objects you are already using. We highly recommend using a generic serialization library. In order to understand how the serializers work and why it is a good idea to use a serialization library, let’s see what it takes to write your own custom serializer.</p>

<p>Suppose that instead of recording just the customer name, you create a simple class to represent customers:</p>

<pre data-type="programlisting">public class Customer {
    private int customerID;
    private String customerName;

    public Customer(int ID, String name) {
        this.customerID = ID;
        this.customerName = name;
    }

    public int getID() {
        return customerID;
    }

    public String getName() {
        return customerName;
    }
}</pre>

<p>Now suppose we want to create a custom serializer for this class. It will look something like this:</p>

<pre data-type="programlisting">import org.apache.kafka.common.errors.SerializationException;

import java.nio.ByteBuffer;
import java.util.Map;

public class CustomerSerializer implements Serializer&lt;Customer&gt; {

    @Override
    public void configure(Map configs, boolean isKey) {
        // nothing to configure
    }

    @Override
    /**
    We are serializing Customer as:
    4 byte int representing customerId
    4 byte int representing length of customerName in UTF-8 bytes (0 if
        name is Null)
    N bytes representing customerName in UTF-8
    */
    public byte[] serialize(String topic, Customer data) {
        try {
            byte[] serializedName;
            int stringSize;
            if (data == null)
                return null;
            else {
                if (data.getName() != null) {
                    serializedName = data.getName().getBytes("UTF-8");
                    stringSize = serializedName.length;
                } else {
                    serializedName = new byte[0];
                    stringSize = 0;
                }
            }

            ByteBuffer buffer = ByteBuffer.allocate(4 + 4 + stringSize);
            buffer.putInt(data.getID());
            buffer.putInt(stringSize);
            buffer.put(serializedName);

            return buffer.array();
        } catch (Exception e) {
            throw new SerializationException(
                "Error when serializing Customer to byte[] " + e);
        }
    }

    @Override
    public void close() {
        // nothing to close
    }
}</pre>

<p>Configuring a producer with this <code>CustomerSerializer</code> will allow you to define <span class="keep-together"><code>ProducerRecord&lt;String, Customer&gt;</code></span>, and send <code>Customer</code> data and pass <code>Customer</code> objects directly to the producer. This example is pretty simple, but you can see how fragile the code is. If we ever have too many customers, for example, and need to change customerID to <code>Long</code>, or if we ever decide to add a <code>startDate</code> field to <code>Customer</code>, we will have a serious issue in maintaining compatibility between old and new messages. Debugging compatibility issues between different versions of serializers and deserializers is fairly challenging—you need to compare arrays of raw bytes. To make matters even worse, if multiple teams in the same company end up writing <code>Customer</code> data to Kafka, they will all need to use the same serializers and modify the code at the exact same time.</p>

<p>For these reasons, we recommend using existing serializers and deserializers such as JSON, Apache Avro, Thrift, or Protobuf. In the following section we will describe Apache Avro and then show how to serialize Avro records and send them to Kafka.<a data-type="indexterm" data-startref="ix_ch03-asciidoc8" id="idm45788273836520"></a><a data-type="indexterm" data-startref="ix_ch03-asciidoc7" id="idm45788273835784"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Serializing Using Apache Avro"><div class="sect2" id="idm45788273834984">
<h2>Serializing Using Apache Avro</h2>

<p><a data-type="indexterm" data-primary="Avro" data-secondary="serializing using" id="ix_ch03-asciidoc9"></a><a data-type="indexterm" data-primary="serializers" data-secondary="serializing using Avro" id="ix_ch03-asciidoc10"></a>Apache Avro is a language-neutral data serialization format. The project was created by Doug Cutting to provide a way to share data files with a large audience.</p>

<p>Avro data is described in a language-independent schema. <a data-type="indexterm" data-primary="schemas" data-secondary="Avro and" id="ix_ch03-asciidoc11"></a>The schema is usually described in JSON and the serialization is usually to binary files, although serializing to JSON is also supported. Avro assumes that the schema is present when reading and writing files, usually by embedding the schema in the files themselves.</p>

<p>One of the most interesting features of Avro, and what makes it a good fit for use in a messaging system like Kafka, is that when the application that is writing messages switches to a new schema, the applications reading the data can continue processing messages without requiring any change or update.</p>

<p>Suppose the original schema was:</p>

<pre data-type="programlisting">{"namespace": "customerManagement.avro",
 "type": "record",
 "name": "Customer",
 "fields": [
     {"name": "id", "type": "int"},
     {"name": "name",  "type": "string"},
     {"name": "faxNumber", "type": ["null", "string"], "default": "null"} <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO5-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO5-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>
 ]
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO5-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO5-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>id and name fields are mandatory, while fax number is optional and defaults to null.</p></dd>
</dl>

<p>We used this schema for a few months and generated a few terabytes of data in this format. Now suppose that we decide that in the new version, we will upgrade to the twenty-first century and will no longer include a fax number field and will instead use an email field.</p>

<p>The new schema would be:</p>

<pre data-type="programlisting">{"namespace": "customerManagement.avro",
 "type": "record",
 "name": "Customer",
 "fields": [
     {"name": "id", "type": "int"},
     {"name": "name",  "type": "string"},
     {"name": "email", "type": ["null", "string"], "default": "null"}
 ]
}</pre>

<p>Now, after upgrading to the new version, old records will contain “faxNumber” and new records will contain “email.” In many organizations, upgrades are done slowly and over many months. So we need to consider how preupgrade applications that still use the fax numbers and postupgrade applications that use email will be able to handle all the events in Kafka.</p>

<p>The reading application will contain calls to methods similar to <code>getName()</code>, <code>getId()</code>, and <code>getFaxNumber()</code>. If it encounters a message written with the new schema, <code>getName()</code> and <code>getId()</code> will continue working with no modification, but <code>getFax</code> <span class="keep-together"><code>Number()</code></span> will return <code>null</code> because the message will not contain a fax number.</p>

<p>Now suppose we upgrade our reading application and it no longer has the <code>getFax</code> <span class="keep-together"><code>Number()</code></span> method but rather <code>getEmail()</code>. If it encounters a message written with the old schema, <code>getEmail()</code> will return <code>null</code> because the older messages do not contain an email address.</p>

<p>This example illustrates the benefit of using Avro: even though we changed the schema in the messages without changing all the applications reading the data, there will be no exceptions or breaking errors and no need for expensive updates of existing data.</p>

<p>However, there are two caveats to this scenario:</p>

<ul>
<li>
<p>The schema used for writing the data and the schema expected by the reading application must be compatible. The Avro documentation includes <a href="http://bit.ly/2t9FmEb">compatibility rules.</a></p>
</li>
<li>
<p>The deserializer will need access to the schema that was used when writing the data, even when it is different than the schema expected by the application that accesses the data. In Avro files, the writing schema is included in the file itself, but there is a better way to handle this for Kafka messages. We will look at that next<a data-type="indexterm" data-startref="ix_ch03-asciidoc11" id="idm45788273805928"></a>.<a data-type="indexterm" data-startref="ix_ch03-asciidoc10" id="idm45788273805096"></a><a data-type="indexterm" data-startref="ix_ch03-asciidoc9" id="idm45788273804392"></a></p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Using Avro Records with Kafka"><div class="sect2" id="idm45788273834392">
<h2>Using Avro Records with Kafka</h2>

<p><a data-type="indexterm" data-primary="Avro" data-secondary="using Avro records with Kafka" id="ix_ch03-asciidoc12"></a><a data-type="indexterm" data-primary="schemas" data-secondary="using Avro records with Kafka" id="ix_ch03-asciidoc13"></a><a data-type="indexterm" data-primary="serializers" data-secondary="using Avro records with Kafka" id="ix_ch03-asciidoc14"></a>Unlike Avro files, where storing the entire schema in the data file is associated with a fairly reasonable overhead, storing the entire schema in each record will usually more than double the record size. However, Avro still requires the entire schema to be present when reading the record, so we need to locate the schema elsewhere. <a data-type="indexterm" data-primary="Schema Registry" id="ix_ch03-asciidoc15"></a>To achieve this, we follow a common architecture pattern and use a <em>Schema Registry</em>. The Schema Registry is not part of Apache Kafka but there are several open source options to choose from. We’ll use the Confluent Schema Registry for this example. You can find the Schema Registry code on <a href="https://github.com/confluentinc/schema-registry">GitHub</a>, or you can install it as part of the <a href="http://docs.confluent.io/current/installation.html">Confluent Platform</a>. If you decide to use the Schema Registry, then we recommend checking the <a href="http://docs.confluent.io/current/schema-registry/docs/index.html">documentation</a>.</p>

<p>The idea is to store all the schemas used to write data to Kafka in the registry. Then we simply store the identifier for the schema in the record we produce to Kafka. The consumers can then use the identifier to pull the record out of the schema registry and deserialize the data. The key is that all this work—storing the schema in the registry and pulling it up when required—is done in the serializers and deserializers. The code that produces data to Kafka simply uses the Avro serializer just like it would any other serializer. <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#fig-2-serializer">Figure&nbsp;3-2</a> demonstrates this process.</p>

<figure><div id="fig-2-serializer" class="figure">
<img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/ktdg_0302.png" alt="ktdg 0302" width="996" height="478" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/ktdg_0302.png">
<h6><span class="label">Figure 3-2. </span>Flow diagram of serialization and deserialization of Avro records</h6>
</div></figure>

<p>Here is an example of how to produce generated Avro objects to Kafka (see the <a href="http://avro.apache.org/docs/current/">Avro Documentation</a> for how to use code generation with Avro):</p>

<pre data-type="programlisting">Properties props = new Properties();

props.put("bootstrap.servers", "localhost:9092");
props.put("key.serializer",
   "io.confluent.kafka.serializers.KafkaAvroSerializer");
props.put("value.serializer",
   "io.confluent.kafka.serializers.KafkaAvroSerializer"); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>
props.put("schema.registry.url", schemaUrl); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a>

String topic = "customerContacts";

Producer&lt;String, Customer&gt; producer = new KafkaProducer&lt;String,
   Customer&gt;(props); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a>

// We keep producing new events until someone ctrl-c
while (true) {
    Customer customer = CustomerGenerator.getNext(); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-4" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-4"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/4.png"></a>
    System.out.println("Generated customer " +
        customer.toString());
    ProducerRecord&lt;String, Customer&gt; record =
        new ProducerRecord&lt;&gt;(topic, customer.getName(), customer); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-5" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-5"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/5.png"></a>
    producer.send(record); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-6" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-6"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/6.png"></a>
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>We use the <code>KafkaAvroSerializer</code> to serialize our objects with Avro. Note that the <code>KafkaAvroSerializer</code> can also handle primitives, which is why we can later use <code>String</code> as the record key and our <code>Customer</code> object as the value.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a></dt>
<dd><p><code>schema.registry.url</code> is a new parameter. This simply points to where we store the schemas.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a></dt>
<dd><p><code>Customer</code> is our generated object. We tell the producer that our records will contain <code>Customer</code> as the value.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-4" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-4"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/4.png"></a></dt>
<dd><p><code>Customer</code> class is not a regular Java class (POJO), but rather a specialized Avro object, generated from a schema using Avro code generation. The Avro serializer can only serialize Avro objects, not POJO. Generating Avro classes can be done either using the avro-tools <em>.jar</em> or the Avro Maven Plugin, both part of Apache Avro. See the <a href="http://avro.apache.org/docs/current/gettingstartedjava.html">Apache Avro Getting Started (Java) guide</a> for details on how to generate Avro classes.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-5" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-5"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/5.png"></a></dt>
<dd><p>We also instantiate <code>ProducerRecord</code> with <code>Customer</code> as the value type, and pass a <code>Customer</code> object when creating the new record.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-6" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO6-6"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/6.png"></a></dt>
<dd><p>That’s it. We send the record with our <code>Customer</code> object and <code>KafkaAvroSerializer</code> will handle the rest.</p></dd>
</dl>

<p>What if you prefer to use generic Avro objects rather than the generated Avro objects? No worries. In this case, you just need to provide the schema:</p>

<pre data-type="programlisting">Properties props = new Properties();
props.put("bootstrap.servers", "localhost:9092");
props.put("key.serializer",
   "io.confluent.kafka.serializers.KafkaAvroSerializer"); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>
props.put("value.serializer",
   "io.confluent.kafka.serializers.KafkaAvroSerializer");
props.put("schema.registry.url", url); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a>

String schemaString =
    "{\"namespace\": \"customerManagement.avro\",
     "\"type\": \"record\", " + <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a>
     "\"name\": \"Customer\"," +
     "\"fields\": [" +
      "{\"name\": \"id\", \"type\": \"int\"}," +
      "{\"name\": \"name\", \"type\": \"string\"}," +
      "{\"name\": \"email\", \"type\": " + "[\"null\",\"string\"], " +
       "\"default\":\"null\" }" +
    "]}";
Producer&lt;String, GenericRecord&gt; producer =
   new KafkaProducer&lt;String, GenericRecord&gt;(props); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-4" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-4"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/4.png"></a>

Schema.Parser parser = new Schema.Parser();
Schema schema = parser.parse(schemaString);

for (int nCustomers = 0; nCustomers &lt; customers; nCustomers++) {
    String name = "exampleCustomer" + nCustomers;
    String email = "example " + nCustomers + "@example.com";

    GenericRecord customer = new GenericData.Record(schema); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-5" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-5"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/5.png"></a>
    customer.put("id", nCustomers);
    customer.put("name", name);
    customer.put("email", email);

    ProducerRecord&lt;String, GenericRecord&gt; data =
        new ProducerRecord&lt;String,
            GenericRecord&gt;("customerContacts", name, customer);
    producer.send(data);
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>We still use the same <code>KafkaAvroSerializer</code>.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a></dt>
<dd><p>And we provide the URI of the same schema registry.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-3" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-3"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/3.png"></a></dt>
<dd><p>But now we also need to provide the Avro schema, since it is not provided by the Avro-generated object.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-4" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-4"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/4.png"></a></dt>
<dd><p>Our object type is an Avro <code>GenericRecord</code>, which we initialize with our schema and the data we want to write.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-5" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO7-5"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/5.png"></a></dt>
<dd><p>Then the value of the <code>ProducerRecord</code> is simply a <code>GenericRecord</code> that contains our schema and data. The serializer will know how to get the schema from this record, store it in the schema registry,<a data-type="indexterm" data-startref="ix_ch03-asciidoc15" id="idm45788273723688"></a> and serialize the object data<a data-type="indexterm" data-startref="ix_ch03-asciidoc14" id="idm45788273722856"></a><a data-type="indexterm" data-startref="ix_ch03-asciidoc13" id="idm45788273722184"></a><a data-type="indexterm" data-startref="ix_ch03-asciidoc12" id="idm45788273721512"></a>.<a data-type="indexterm" data-startref="ix_ch03-asciidoc6" id="idm45788273720712"></a><a data-type="indexterm" data-startref="ix_ch03-asciidoc5" id="idm45788273720008"></a></p></dd>
</dl>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Partitions"><div class="sect1" id="idm45788273803000">
<h1>Partitions</h1>

<p><a data-type="indexterm" data-primary="partitions" data-secondary="producers and" id="ix_ch03-asciidoc16"></a><a data-type="indexterm" data-primary="producers" data-secondary="partitions" id="ix_ch03-asciidoc17"></a>In previous examples, the <code>ProducerRecord</code> objects we created included a topic name, key, and value. <a data-type="indexterm" data-primary="key-value pairs" id="idm45788273715016"></a>Kafka messages are key-value pairs and while it is possible to create a <code>ProducerRecord</code> with just a topic and a value, with the key set to <code>null</code> by default, most applications produce records with keys. <a data-type="indexterm" data-primary="keys" data-secondary="purposes of" id="idm45788273713240"></a>Keys serve two goals: they are additional information that gets stored with the message, and they are also used to decide which one of the topic partitions the message will be written to. All messages with the same key will go to the same partition. This means that if a process is reading only a subset of the partitions in a topic (more on that in <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch04.html#reading_data_from_kafka">Chapter&nbsp;4</a>), all the records for a single key will be read by the same process. To create a key-value record, you simply create a <code>ProducerRecord</code> as follows:</p>

<pre data-type="programlisting">ProducerRecord&lt;String, String&gt; record =
    new ProducerRecord&lt;&gt;("CustomerCountry", "Laboratory Equipment", "USA");</pre>

<p>When creating messages with a null key, you can simply leave the key out:</p>

<pre data-type="programlisting">ProducerRecord&lt;String, String&gt; record =
    new ProducerRecord&lt;&gt;("CustomerCountry", "USA"); <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO8-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO8-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO8-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO8-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>Here, the key will simply be set to <code>null</code>.</p></dd>
</dl>

<p>When the key is <code>null</code> and the default partitioner is used, the record will be sent to one of the available partitions of the topic at random. A round-robin algorithm will be used to balance the messages among the partitions.</p>

<p>If a key exists and the default partitioner is used, Kafka will hash the key (using its own hash algorithm, so hash values will not change when Java is upgraded), and use the result to map the message to a specific partition. Since it is important that a key is always mapped to the same partition, we use all the partitions in the topic to calculate the mapping—not just the available partitions. This means that if a specific partition is unavailable when you write data to it, you might get an error. This is fairly rare, as you will see in <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch06.html#reliable_data_delivery">Chapter&nbsp;6</a> when we discuss Kafka’s replication and availability.</p>

<p><a data-type="indexterm" data-primary="keys" data-secondary="mapping to partitions" id="idm45788273699320"></a><a data-type="indexterm" data-primary="partitions" data-secondary="keys and" id="idm45788273698344"></a>The mapping of keys to partitions is consistent only as long as the number of partitions in a topic does not change. So as long as the number of partitions is constant, you can be sure that, for example, records regarding user 045189 will always get written to partition 34. This allows all kinds of optimization when reading data from partitions. However, the moment you add new partitions to the topic, this is no longer guaranteed—the old records will stay in partition 34 while new records will get written to a different partition. When partitioning keys is important, the easiest solution is to create topics with sufficient partitions (<a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch02.html#installing_kafka">Chapter&nbsp;2</a> includes suggestions for how to determine a good number of partitions) and never add partitions.</p>










<section data-type="sect3" data-pdf-bookmark="Implementing a custom partitioning strategy"><div class="sect3" id="idm45788273695576">
<h3>Implementing a custom partitioning strategy</h3>

<p><a data-type="indexterm" data-primary="partitions" data-secondary="custom strategies" id="idm45788273694200"></a>So far, we have discussed the traits of the default partitioner, which is the one most commonly used. However, Kafka does not limit you to just hash partitions, and sometimes there are good reasons to partition data differently. For example, suppose that you are a B2B vendor and your biggest customer is a company that manufactures handheld devices called Bananas. Suppose that you do so much business with customer “Banana” that over 10% of your daily transactions are with this customer. If you use default hash partitioning, the Banana records will get allocated to the same partition as other accounts, resulting in one partition being much larger than the rest. This can cause servers to run out of space, processing to slow down, etc. What we really want is to give Banana its own partition and then use hash partitioning to map the rest of the accounts to partitions.</p>

<p class="pagebreak-before">Here is an example of a custom partitioner:</p>

<pre data-type="programlisting">import org.apache.kafka.clients.producer.Partitioner;
import org.apache.kafka.common.Cluster;
import org.apache.kafka.common.PartitionInfo;
import org.apache.kafka.common.record.InvalidRecordException;
import org.apache.kafka.common.utils.Utils;

public class BananaPartitioner implements Partitioner {

    public void configure(Map&lt;String, ?&gt; configs) {} <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a>

    public int partition(String topic, Object key, byte[] keyBytes,
                         Object value, byte[] valueBytes,
                         Cluster cluster) {
        List&lt;PartitionInfo&gt; partitions = cluster.partitionsForTopic(topic);
        int numPartitions = partitions.size();

        if ((keyBytes == null) || (!(key instanceOf String))) <a class="co" id="co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a>
            throw new InvalidRecordException("We expect all messages " +
                "to have customer name as key")

        if (((String) key).equals("Banana"))
            return numPartitions - 1; // Banana will always go to last partition

        // Other records will get hashed to the rest of the partitions
        return (Math.abs(Utils.murmur2(keyBytes)) % (numPartitions - 1))
    }

    public void close() {}
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-1" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-1"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/1.png"></a></dt>
<dd><p>Partitioner interface includes <code>configure</code>, <code>partition</code>, and <code>close</code> methods. Here we only implement <code>partition</code>, although we really should have passed the special customer name through <code>configure</code> instead of hard-coding it in <code>partition</code>.</p></dd>
<dt><a class="co" id="callout_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-2" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#co_kafka_producers__writing_messages__span_class__keep_together__to_kafka__span__CO9-2"><img src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/kafka-the-definitive/9781491936153/assets/2.png"></a></dt>
<dd><p>We only expect String keys, so we throw an exception if that is not the case.<a data-type="indexterm" data-startref="ix_ch03-asciidoc17" id="idm45788273677336"></a><a data-type="indexterm" data-startref="ix_ch03-asciidoc16" id="idm45788273676536"></a></p></dd>
</dl>
</div></section>



</div></section>













<section data-type="sect1" data-pdf-bookmark="Old Producer APIs"><div class="sect1" id="idm45788273718872">
<h1>Old Producer APIs</h1>

<p><a data-type="indexterm" data-primary="APIs" data-secondary="producer" id="idm45788273674664"></a><a data-type="indexterm" data-primary="producers" data-secondary="old APIs" id="idm45788273673464"></a>In this chapter we’ve discussed the Java producer client that is part of the <code>org.apache.kafka.clients</code> package.
However, Apache Kafka still has two older clients written in Scala that are part of the <code>kafka.producer</code> package and the core Kafka module. <a data-type="indexterm" data-primary="SyncProducers" id="idm45788273671512"></a>These producers are called <code>SyncProducers</code> (which, depending on the value of the <code>acks</code> parameter, may wait for the server to <code>ack</code> each message or batch of messages before sending additional messages) <a data-type="indexterm" data-primary="AsyncProducer" id="idm45788273669416"></a>and <code>AsyncProducer</code> (which batches messages in the background, sends them in a separate thread, and does not provide feedback regarding success to the client).</p>

<p>Because the current producer supports both behaviors and provides much more reliability and control to the developer, we will not discuss the older APIs. If you are interested in using them, think twice and then refer to Apache Kafka documentation to learn more.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm45788273667144">
<h1>Summary</h1>

<p>We began this chapter with a simple example of a producer—just 10 lines of code that send events to Kafka. We added to the simple example by adding error handling and experimenting with synchronous and asynchronous producing. We then explored the most important producer configuration parameters and saw how they modify the behavior of the producers.
We discussed serializers, which let us control the format of the events we write to Kafka. We looked in-depth at Avro, one of many ways to serialize events, but one that is very commonly used with Kafka.
We concluded the chapter with a discussion of partitioning in Kafka and an example of an advanced custom partitioning technique.<a data-type="indexterm" data-startref="ix_ch03-asciidoc0" id="idm45788273665048"></a></p>

<p>Now that we know how to write events to Kafka, in <a data-type="xref" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch04.html#reading_data_from_kafka">Chapter&nbsp;4</a> we’ll learn all about consuming events from Kafka.</p>
</div></section>







</div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none; top: 2450px; left: 300.5px; width: 259px;">
	<ul class="adders expandUp">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch02.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">2. Installing Kafka</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch04.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">4. Kafka Consumers: Reading Data from Kafka</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
        

        
        

      </div>

    
    



        
      </div>
      
        

<footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
  <a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" class="icon-up" onclick="window.Appcues.track(&#39;JumpTop_HeronBook&#39;)" style="display: block;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">© 2020 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>

      
    
    <script src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/saved_resource" charset="utf-8"></script><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/embed.js.download"></script>
    <script src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/saved_resource(1)" charset="utf-8"></script>
  

<div></div><div></div><div class="annotator-notice"></div><div class="font-flyout" style="top: 201px; left: 1280px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/kafka-the-definitive/9781491936153/ch03.html#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./3. Kafka Producers_ Writing Messages to Kafka - Kafka_ The Definitive Guide_files/generic1607612729884.js.download" charset="UTF-8"></script><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span></span></body></html>